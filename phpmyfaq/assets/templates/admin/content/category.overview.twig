<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">
    <i aria-hidden="true" class="bi bi-folder"></i> {{ msgHeaderCategoryOverview }}
  </h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <div class="btn-group mr-2">
      <a class="btn btn-outline-success" href="?action=addcategory" id="addCategoryModal">
        <i aria-hidden="true" class="bi bi-plus"></i> {{ msgAddCategory }}
      </a>
      <a class="btn btn-outline-info" href="?action=showcategory">
        <i aria-hidden="true" class="bi bi-list"></i> {{ msgCategoryMatrix }}
      </a>
    </div>
  </div>
</div>

<div class="row mb-2">
  <div class="col">
    <form method="post">
      {{ csrfTokenInput | raw }}
      <div id="pmf-category-tree" class="list-group nested-sortable">
        {{ _self.renderCategories(categoryTree, categoryInfo) }}
      </div>
    </form>
  </div>
</div>

<div class="row mt-4">
  <div class="col">
    <div class="alert alert-info">
      {{ msgCategoryRemark }}
    </div>
  </div>
</div>

{% macro renderCategories(categories, categoryInfo, depth = 1) %}
  {% for key, children in categories %}
    <div class="list-group-item nested-{{ depth }}" id="pmf-category-{{ categoryInfo[key]['id'] }}"
         data-pmf-catid="{{ categoryInfo[key]['id'] }}">
      <div class="border-left-0 border-right-0 d-flex justify-content-between align-items-center">
        <h6 class="m-2">
          {{ categoryInfo[key]['name'] }}

          {% if categoryInfo[key]['show_home'] == 1 %}
            <i class="bi bi-star" aria-hidden="true"></i>
          {% endif %}
        </h6>

        <div class="pmf-category-actions">
          <!-- Add FAQ to category (always) -->
          <a class="btn btn-info mb-1 mt-1"
             href="?action=editentry&cat={{ categoryInfo[key]['id'] }}&lang={{ categoryInfo[key]['lang'] }}">
            <i aria-hidden="true" class="bi bi-indent" title="{{ msgAddFaqAction }}"></i>
          </a>

          <!-- Add subcategory (if current language) -->
          <a class="btn btn-info"
             href="?action=addcategory&cat={{ categoryInfo[key]['id'] }}&lang={{ categoryInfo[key]['lang'] }}">
            <i aria-hidden="true" class="bi bi-plus-square" title="{{ msgAddCategoryAction }}"></i>
          </a>

          <!-- Edit category (if current language) -->
          <a class="btn btn-info"
             href="?action=editcategory&cat={{ categoryInfo[key]['id'] }}">
            <i aria-hidden="true" class="bi bi-pencil" title="{{ msgEditCategoryAction }}"></i>
          </a>

          <!-- Translate category -->
          <a class="btn btn-info"
             href="?action=translatecategory&cat={{ categoryInfo[key]['id'] }}">
            <i aria-hidden="true" class="bi bi-globe" title="{{ msgTranslateCategoryAction }}"></i>
          </a>

          <!-- Delete category (if no subcategories) -->
          {% if children is empty %}
            <button type="button" class="btn btn-danger" name="pmf-category-delete-button"
                    data-pmf-category-id="{{ categoryInfo[key]['id'] }}"
                    data-pmf-language="{{ categoryInfo[key]['lang'] }}">
              <i aria-hidden="true" class="bi bi-trash" title="%s"
                 data-pmf-category-id="{{ categoryInfo[key]['id'] }}"
                 data-pmf-language="{{ categoryInfo[key]['lang'] }}"></i>
            </button>
          {% else %}
            <div class="btn btn-inverse border" style="cursor: not-allowed;">
              <i aria-hidden="true" class="bi bi-trash"></i>
            </div>
          {% endif %}
        </div>
      </div>
      {% if children is not empty %}
        <div class="list-group nested-sortable">
          {{ _self.renderCategories(children, categoryInfo, depth + 1) }}
        </div>
      {% endif %}
    </div>
  {% endfor %}
{% endmacro %}
