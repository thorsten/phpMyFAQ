{"version":3,"file":"setup.js","sources":["../src/configuration/setup.ts","../src/setup.ts"],"sourcesContent":["/**\n * Setup functions\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at https://mozilla.org/MPL/2.0/.\n *\n * @package   phpMyFAQ\n * @author    Thorsten Rinne <thorsten@phpmyfaq.de>\n * @copyright 2015-2025 phpMyFAQ Team\n * @license   http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link      https://www.phpmyfaq.de\n * @since     2015-12-24\n */\n\nimport { insertAfter } from '../utils';\n\nexport const selectDatabaseSetup = (event: Event): void => {\n  const form = document.getElementById('phpmyfaq-setup-form') as HTMLFormElement;\n  const inputs = form.getElementsByTagName('input') as HTMLCollectionOf<HTMLInputElement>;\n  const database = document.getElementById('dbdatafull') as HTMLElement;\n  const databasePort = document.getElementById('sql_port') as HTMLInputElement;\n  const sqlite = document.getElementById('dbsqlite') as HTMLElement;\n\n  const target = event.target as HTMLSelectElement;\n\n  if (target.value === 'sqlite3' || target.value === 'pdo_sqlite') {\n    for (let i: number = 0; i < inputs.length; i++) {\n      inputs[i].removeAttribute('required');\n    }\n  } else {\n    document.getElementById('sql_server')?.setAttribute('required', 'required');\n    document.getElementById('sql_port')?.setAttribute('required', 'required');\n    document.getElementById('sql_user')?.setAttribute('required', 'required');\n    document.getElementById('faqpassword')?.setAttribute('required', 'required');\n    document.getElementById('sql_db')?.setAttribute('required', 'required');\n  }\n\n  switch (target.value) {\n    case 'mysqli':\n    case 'pdo_mysql':\n      databasePort.value = '3306';\n      sqlite.className = 'd-none';\n      database.className = 'd-block';\n      break;\n    case 'pgsql':\n    case 'pdo_pgsql':\n      databasePort.value = '5432';\n      sqlite.className = 'd-none';\n      database.className = 'd-block';\n      break;\n    case 'sqlsrv':\n    case 'pdo_sqlsrv':\n      databasePort.value = '1433';\n      sqlite.className = 'd-none';\n      database.className = 'd-block';\n      break;\n    case 'sqlite3':\n    case 'pdo_sqlite':\n      sqlite.className = 'd-block';\n      database.className = 'd-none';\n      break;\n    default:\n      sqlite.className = 'd-none';\n      database.className = 'd-block';\n      break;\n  }\n};\n\nexport const addElasticsearchServerInput = (): void => {\n  const wrapper = document.getElementById('elasticsearch-server-wrapper') as HTMLElement;\n  const input = document.createElement('input') as HTMLInputElement;\n\n  // Set attributes for input\n  input.className = 'form-control mt-1';\n  input.type = 'text';\n  input.name = 'elasticsearch_server[]';\n  input.placeholder = '127.0.0.1:9200';\n\n  insertAfter(wrapper, input);\n};\n\nexport const stepIndicator = (step: number): void => {\n  // This function removes the \"active\" class of all steps...\n  const steps = document.getElementsByClassName('stepIndicator') as HTMLCollectionOf<HTMLElement>;\n  for (let i: number = 0; i < steps.length; i++) {\n    steps[i].className = steps[i].className.replace(' active', '');\n  }\n  //... and adds the \"active\" class on the current step:\n  steps[step].className += ' active';\n};\n","/**\n * Setup functions\n *\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at https://mozilla.org/MPL/2.0/.\n *\n * @package   phpMyFAQ\n * @author    Thorsten Rinne <thorsten@phpmyfaq.de>\n * @copyright 2015-2025 phpMyFAQ Team\n * @license   http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0\n * @link      https://www.phpmyfaq.de\n * @since     2015-12-24\n */\n\nimport { handlePasswordToggle } from './utils';\nimport { addElasticsearchServerInput, selectDatabaseSetup, stepIndicator } from './configuration';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  'use strict';\n\n  // Toggle password visibility\n  handlePasswordToggle();\n\n  // Switch between database selection\n  const setupType: HTMLElement | null = document.getElementById('sql_type');\n  if (setupType) {\n    setupType.addEventListener('change', selectDatabaseSetup);\n  }\n\n  // Add more Elasticsearch server inputs\n  const addElasticsearch: HTMLElement | null = document.getElementById('pmf-add-elasticsearch-host');\n  if (addElasticsearch) {\n    addElasticsearch.addEventListener('click', addElasticsearchServerInput);\n  }\n\n  // Wizard\n  let currentTab: number = 0;\n  const nextButton: HTMLElement | null = document.getElementById('nextBtn');\n  const prevButton: HTMLElement | null = document.getElementById('prevBtn');\n  if (nextButton) {\n    nextButton.addEventListener('click', (event) => {\n      event.preventDefault();\n      nextPrev(1);\n    });\n  }\n  if (prevButton) {\n    prevButton.addEventListener('click', (event) => {\n      event.preventDefault();\n      nextPrev(-1);\n    });\n  }\n  showTab(currentTab);\n\n  function showTab(number: number): void {\n    const currentStep: HTMLCollectionOf<Element> = document.getElementsByClassName('step');\n\n    if (currentStep.length > 0) {\n      (currentStep[number] as HTMLElement).style.display = 'block';\n    }\n\n    const prevButton: HTMLElement | null = document.getElementById('prevBtn');\n    const nextButton: HTMLElement | null = document.getElementById('nextBtn');\n\n    if (prevButton && nextButton) {\n      if (number === 0) {\n        prevButton.style.display = 'none';\n      } else {\n        prevButton.style.display = 'inline';\n      }\n      if (number === currentStep.length - 1) {\n        nextButton.innerHTML = 'Submit';\n      } else {\n        nextButton.innerHTML = 'Next';\n      }\n      stepIndicator(number);\n    }\n  }\n\n  const nextPrev = (n: number) => {\n    const currentStep: HTMLCollectionOf<Element> = document.getElementsByClassName('step');\n    const prevButton = document.getElementById('prevBtn') as HTMLElement;\n    const nextButton = document.getElementById('nextBtn') as HTMLElement;\n    const installButton = document.getElementById('installingBtn') as HTMLElement;\n\n    if (n === 1 && !validateForm()) {\n      return false;\n    }\n\n    (currentStep[currentTab] as HTMLElement).style.display = 'none';\n    currentTab = currentTab + n;\n    if (currentTab >= currentStep.length) {\n      prevButton.classList.add('d-none');\n      nextButton.classList.add('d-none');\n      installButton.classList.remove('d-none');\n      (document.getElementById('phpmyfaq-setup-form') as HTMLFormElement).submit();\n      return false;\n    }\n\n    showTab(currentTab);\n  };\n\n  const validateForm = (): boolean => {\n    let currentStep,\n      y,\n      i,\n      valid = true;\n    currentStep = document.getElementsByClassName('step') as HTMLCollectionOf<HTMLElement>;\n    y = currentStep[currentTab].querySelectorAll('input,select');\n\n    for (i = 0; i < y.length; i++) {\n      if ((y[i] as HTMLInputElement).value === '' && y[i].hasAttribute('required')) {\n        y[i].className += ' is-invalid';\n        // and set the current valid status to false\n        valid = false;\n      }\n    }\n    // If the valid status is true, mark the step as finished and valid:\n    if (valid) {\n      document.getElementsByClassName('stepIndicator')[currentTab].className += ' finish';\n    }\n\n    return valid; // return the valid status\n  };\n});\n"],"names":["selectDatabaseSetup","event","inputs","document","getElementById","getElementsByTagName","database","databasePort","sqlite","target","value","i","length","removeAttribute","setAttribute","className","addElasticsearchServerInput","wrapper","input","createElement","type","name","placeholder","insertAfter","addEventListener","handlePasswordToggle","setupType","addElasticsearch","currentTab","nextButton","prevButton","showTab","number","currentStep","getElementsByClassName","style","display","innerHTML","step","steps","replace","stepIndicator","preventDefault","nextPrev","n","installButton","validateForm","classList","add","remove","submit","y","valid","querySelectorAll","hasAttribute"],"mappings":"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"}