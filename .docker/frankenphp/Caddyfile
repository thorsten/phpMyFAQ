{
    # Enable debug mode for development
    debug

    # Auto HTTPS off for development
    auto_https off

    order php_server before file_server
}

:80 {
    # Document root
    root * /var/www/html

    # Enable compression
    encode gzip

    # PHP Handler for FrankenPHP
    php_server

    # Exclude assets from being handled by router
    @assets path /admin/assets*
    file_server @assets

    # Error pages
    handle_errors 404 {
        rewrite * /404.html
        php_server
    }

    # Setup pages
    @setup path /setup*
    rewrite @setup /setup/index.php

    # Update page - route directly to index.php (handled by Symfony router)
    @update path /update*
    rewrite @update /index.php

    # Administration API
    @admin_api path /admin/api/*
    rewrite @admin_api /admin/api/index.php

    # Redirect /admin to /admin/
    @admin_exact path_regexp ^/admin$
    redir @admin_exact /admin/ 301

    # Administration pages
    handle_path /admin/* {
        rewrite * /admin/index.php
    }

    # API routes (all API endpoints)
    @api path /api/*
    rewrite @api /api/index.php

    file_server

    header {
        X-Frame-Options DENY
        X-Content-Type-Options nosniff
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
    }

    log {
        output stdout
        format console
        level DEBUG
    }
}

:443 {
    # Document root
    root * /var/www/html

    # Enable compression
    encode gzip

    # TLS configuration with your certificate files
    tls /etc/ssl/cert.pem /etc/ssl/cert-key.pem

    # PHP Handler for FrankenPHP
    php_server

    # Exclude assets from being handled by router
    @assets path /admin/assets*
    file_server @assets

    # Error pages
    handle_errors 404 {
        rewrite * /404.html
        php_server
    }

    # Setup pages
    @setup path /setup*
    rewrite @setup /setup/index.php

    # Update page - route directly to index.php (handled by Symfony router)
    @update path /update*
    rewrite @update /index.php

    # Administration API
    @admin_api path /admin/api/*
    rewrite @admin_api /admin/api/index.php

    # Redirect /admin to /admin/
    @admin_exact path_regexp ^/admin$
    redir @admin_exact /admin/ 301

    # Administration pages
    handle_path /admin/* {
        rewrite * /admin/index.php
    }

    # API routes (all API endpoints)
    @api path /api/*
    rewrite @api /api/index.php

    file_server

    header {
        X-Frame-Options DENY
        X-Content-Type-Options nosniff
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
    }

    log {
        output stdout
        format console
        level INFO
    }
}
