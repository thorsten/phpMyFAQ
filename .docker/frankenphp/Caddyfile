{
    # Enable debug mode for development
    debug

    # Auto HTTPS off for development
    auto_https off

    order php_server before file_server
}

:80 {
    # Document root
    root * /var/www/html

    # Enable compression
    encode gzip

    # Exclude assets from being handled by router
    @assets path /admin/assets*
    file_server @assets

    # Error pages
    handle_errors 404 {
        rewrite * /404.html
        php_server
    }

    # Setup and update pages
    @setup path /setup*
    rewrite @setup /setup/index.php

    # Administration API
    route /admin/api/* {
        rewrite * /admin/api/index.php
        php_server
    }

    # Administration pages - handle /admin and /admin/ and subpaths
    route /admin/* {
        uri strip_prefix /admin
        rewrite * /admin/index.php
        php_server
    }

    # Exact match for /admin -> treat as /admin/
    route /admin {
        uri strip_suffix /admin
        rewrite * /admin/index.php
        php_server
    }

    # All API routes (catch-all, including v3.0, v3.1, translations, etc.)
    @api path /api*
    rewrite @api /api/index.php

    # PHP Handler für FrankenPHP
    php_server

    file_server

    header {
        X-Frame-Options DENY
        X-Content-Type-Options nosniff
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
    }

    log {
        output stdout
        format console
        level DEBUG
    }
}

:443 {
    # Document root
    root * /var/www/html

    # Enable compression
    encode gzip

    # TLS configuration with your certificate files
    tls /etc/ssl/cert.pem /etc/ssl/cert-key.pem

    # Gleiche Rewrite-Regeln wie für Port 80
    @assets path /admin/assets*
    file_server @assets

    handle_errors 404 {
        rewrite * /404.html
        php_server
    }

    @setup path /setup*
    rewrite @setup /setup/index.php

    @update path /update*
    rewrite @update /update/index.php

    # Administration API
    route /admin/api/* {
        rewrite * /admin/api/index.php
        php_server
    }

    # Administration pages - handle /admin and /admin/ and subpaths
    route /admin/* {
        uri strip_prefix /admin
        rewrite * /admin/index.php
        php_server
    }

    # Exact match for /admin -> treat as /admin/
    route /admin {
        uri strip_suffix /admin
        rewrite * /admin/index.php
        php_server
    }

    # All API routes (catch-all, including v3.0, v3.1, translations, etc.)
    @api path /api*
    rewrite @api /api/index.php

    # PHP Handler für FrankenPHP
    php_server

    file_server

    header {
        X-Frame-Options DENY
        X-Content-Type-Options nosniff
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
    }

    log {
        output stdout
        format console
        level INFO
    }
}
